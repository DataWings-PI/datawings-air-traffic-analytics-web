<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataWings - Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="icon" href="..//assets/icon/favicon-data.png">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

    <section class="full-body">
        <!-- ====== CABE√áALHO ====== -->
        <div class="left-header">
            <div class="content">
                <div>
                    <img class="logo" src="../assets/logoLaranja-removebg-preview.png" alt="">
                </div>

                <div class="user">
                    <span id="nome"></span>
                </div>

                <h2 class="welcome-text">Estat√≠sticas de voos</h2>

            </div>

            <div class="content2">

                <select id="meuSelect" onchange="window.location.href = this.value;">
                    <option value="dashboard.html" selected>Dashboard</option>
                    <option value="relatorio.html">Relat√≥rios</option>
                    <option value="slack.html">Notifica√ß√µes</option>
                </select>

                <a href="index.html">
                    <button class="botao-sair">
                        Sair
                    </button>
                </a>
            </div>
        </div>


        <div class="middle">
            <div class="texto-box">
                <h3>
                    Dados relacionados aos voos
                </h3>

                <button id="tabelaDadosVoos" class="botoes-modal">
                    Tabela Dados dos voos
                </button>
            </div>

            <div class="graficos-box">
                <div class="cards-grafico-1">
                    <canvas id="meuGraficoBarra1"></canvas>
                </div>
                <button id="tabelaLegendaJustificativas" class="botoes-modal">
                    Tabela justificativa legendas
                </button>

                <div class="cards-grafico-2-1">
                    <canvas id="meuGraficoBarra2"></canvas>
                </div>
            </div>
        </div>

        <div class="last">
            <div class="capa">

                <div class="contain-parte-cima">
                    <div class="divisao-pt0">
                        <h3>
                            An√°lise de setores do total de voos
                        </h3>
                    </div>
                    <div class="divisao-pt1">

                        <div class="card">
                            <div class="card-bar1"></div>
                            <p>Total de voos analisados</p>
                            <p class="subtitulo" id="kpi1"></p>
                        </div>

                        <div class="card">
                            <div class="card-bar2"></div>
                            <p>Voos sem nenhum atraso</p>
                            <p class="subtitulo" id="kpi2">
                            </p>
                        </div>
                    </div>

                    <div class="divisao-pt2">
                        <div class="card">
                            <div class="card-bar4"></div>
                            <p>Voos com atraso</p>
                            <p class="subtitulo" id="kpi3">
                            </p>
                        </div>

                        <div class="card">
                            <div class="card-bar5"></div>
                            <p>Voos que foram cancelados</p>
                            <p class="subtitulo" id="kpi4">10.000 voos | <span
                                    style="color: #3A6EA5; font-weight: bolder;">10%</span>
                            </p>
                        </div>
                    </div>
                </div>


                <div class="contain-parte-baixo">
                    <canvas class="grafico-torta" id="meuGraficoPie"></canvas>
                </div>

            </div>
        </div>

    </section>

    <!-- ------------------------- Modais ----------------------- -->

    <div id="modal2">
        <div class="modal-tabela-conteudo">

            <span class="fechar" id="modal2-fechar">&times;</span>

            <div class="tabela-scroll">

                <table id="voosTable">
                    <thead>
                        <tr>
                            <th>N√∫mero Voo</th>
                            <th>Data prevista</th>
                            <th>Previs√£o Partida</th>
                            <th>Previs√£o Chegada</th>
                            <th>Partida</th>
                            <th>Chegada</th>
                            <th>Atraso chegada</th>
                            <th>Atraso Partida</th>
                            <th>Atraso Total</th>
                            <th>Origem</th>
                            <th>Destino</th>
                            <th>C√≥digo Justificativa</th>
                        </tr>
                    </thead>
                    <tbody id="tbody_voos">
                        <tr>
                            <td>101</td>
                            <td>01/01/2025</td>
                            <td>08:15</td>
                            <td>10:00</td>
                            <td>08:20</td>
                            <td>10:05</td>
                            <td>1 min</td>
                            <td>4 min</td>
                            <td>5 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>DG</td>
                        </tr>
                        <tr>
                            <td>102</td>
                            <td>01/01/2025</td>
                            <td>09:00</td>
                            <td>11:00</td>
                            <td>09:10</td>
                            <td>11:05</td>
                            <td>10 min</td>
                            <td>20 min</td>
                            <td>30 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>AA</td>

                        </tr>
                        <tr>
                            <td>103</td>
                            <td>01/01/2025</td>
                            <td>09:30</td>
                            <td>11:30</td>
                            <td>09:35</td>
                            <td>11:50</td>
                            <td>10 min</td>
                            <td>10 min</td>
                            <td>20 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>AA</td>

                        </tr>
                        <tr>
                            <td>104</td>
                            <td>01/01/2025</td>
                            <td>10:00</td>
                            <td>12:00</td>
                            <td>10:05</td>
                            <td>12:10</td>
                            <td>3 min</td>
                            <td>7 min</td>
                            <td>10 min</td>
                            <td>PE</td>
                            <td>SP</td>
                            <td>AR</td>
                        </tr>
                        <tr>
                            <td>105</td>
                            <td>01/01/2025</td>
                            <td>10:30</td>
                            <td>12:30</td>
                            <td>10:35</td>
                            <td>12:40</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>RJ</td>
                            <td>RR</td>
                            <td>AT</td>
                        </tr>
                        <tr>
                            <td>106</td>
                            <td>01/01/2025</td>
                            <td>11:00</td>
                            <td>13:00</td>
                            <td>11:05</td>
                            <td>13:20</td>
                            <td>7 min</td>
                            <td>13 min</td>
                            <td>20 min</td>
                            <td>SP</td>
                            <td>MG</td>
                            <td>AF</td>
                        </tr>
                        <tr>
                            <td>107</td>
                            <td>01/01/2025</td>
                            <td>11:30</td>
                            <td>13:30</td>
                            <td>11:35</td>
                            <td>13:45</td>
                            <td>7 min</td>
                            <td>8 min</td>
                            <td>15 min</td>
                            <td> RJ</td>
                            <td> BA</td>
                            <td>AS</td>
                        </tr>
                        <tr>
                            <td>108</td>
                            <td>01/01/2025</td>
                            <td>12:00</td>
                            <td>14:00</td>
                            <td>12:05</td>
                            <td>14:10</td>
                            <td>8 min</td>
                            <td>2 min</td>
                            <td>10 min</td>
                            <td>DF</td>
                            <td>AM</td>
                            <td>AS</td>
                        </tr>
                        <tr>
                            <td>109</td>
                            <td>01/01/2025</td>
                            <td>12:30</td>
                            <td>14:30</td>
                            <td>12:40</td>
                            <td>14:50</td>
                            <td>10 min</td>
                            <td>10 min</td>
                            <td>20 min</td>
                            <td>RS</td>
                            <td>PR</td>
                            <td>DF</td>
                        </tr>
                        <tr>
                            <td>110</td>
                            <td>01/01/2025</td>
                            <td>13:00</td>
                            <td>15:00</td>
                            <td>13:05</td>
                            <td>15:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>GO</td>
                            <td>PA</td>
                            <td>GF</td>
                        </tr>
                        <tr>
                            <td>111</td>
                            <td>01/01/2025</td>
                            <td>13:30</td>
                            <td>15:30</td>
                            <td>13:35</td>
                            <td>15:50</td>
                            <td>6 min</td>
                            <td>14 min</td>
                            <td>20 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WS</td>

                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>
                        <tr>
                            <td>112</td>
                            <td>01/01/2025</td>
                            <td>14:00</td>
                            <td>16:00</td>
                            <td>14:05</td>
                            <td>16:10</td>
                            <td>5 min</td>
                            <td>5 min</td>
                            <td>10 min</td>
                            <td>SP</td>
                            <td>PE</td>
                            <td>WP</td>
                        </tr>

                    </tbody>
                </table>

            </div>

        </div>
    </div>

    <div id="modal3">
        <div class="modal-tabela-conteudo">

            <span class="fechar" id="modal3-fechar">&times;</span>
            <div class="tabela-scroll">

                <table id="voosTable">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descri√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AA</td>
                            <td>ATRASO AEROPORTO DE ALTERNATIVA ‚Äì ORDEM T√âCNICA</td>
                        </tr>
                        <tr>
                            <td>AF</td>
                            <td>FACILIDADES DO AEROPORTO - RESTRI√á√ïES DE APOIO</td>
                        </tr>
                        <tr>
                            <td>AG</td>
                            <td>MIGRA√á√ÉO/ALF√ÇNDEGA/SA√öDE</td>
                        </tr>
                        <tr>
                            <td>AI</td>
                            <td>AEROPORTO DE ORIGEM INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>AJ</td>
                            <td>AEROPORTO DE DESTINO INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>AM</td>
                            <td>ATRASO AEROPORTO DE ALTERNATIVA ‚Äì CONDI√á√ïES METEOROL√ìGICAS</td>
                        </tr>
                        <tr>
                            <td>AS</td>
                            <td>SEGURAN√áA/PAX/CARGA/ALARME</td>
                        </tr>
                        <tr>
                            <td>AR</td>
                            <td>AEROPORTO COM RESTRI√á√ïES OPERACIONAIS</td>
                        </tr>
                        <tr>
                            <td>AT</td>
                            <td>LIBERA√á√ÉO SERV. TR√ÅFEGO A√âREO/ANTECIPA√á√ÉO</td>
                        </tr>
                        <tr>
                            <td>DF</td>
                            <td>AVARIA DURANTE OPERA√á√ïES EM V√îO</td>
                        </tr>
                        <tr>
                            <td>DG</td>
                            <td>AVARIA DURANTE OPERA√á√ïES EM SOLO</td>
                        </tr>
                        <tr>
                            <td>FP</td>
                            <td>PLANO DE V√îO - APROVA√á√ÉO</td>
                        </tr>
                        <tr>
                            <td>GF</td>
                            <td>ABASTECIMENTO/DESTANQUEIO</td>
                        </tr>
                        <tr>
                            <td>MA</td>
                            <td>FALHA EQUIPO AUTOMOTIVO E DE ATENDIMENTO DE PAX</td>
                        </tr>
                        <tr>
                            <td>MX</td>
                            <td>ATRASOS N√ÉO ESPEC√çFICOS ‚Äì OUTROS</td>
                        </tr>
                        <tr>
                            <td>OA</td>
                            <td>AUTORIZADO</td>
                        </tr>
                        <tr>
                            <td>RA</td>
                            <td>CONEX√ÉO DE AERONAVE</td>
                        </tr>
                        <tr>
                            <td>RI</td>
                            <td>CONEX√ÉO AERONAVE/VOLTA ‚Äì V√îO DE IDA N√ÉO PENALIZADO - AEROPORTO INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>RM</td>
                            <td>CONEX√ÉO AERONAVE/VOLTA ‚Äì V√îO DE IDA N√ÉO PENALIZADO - CONDI√á√ïES METEOROL√ìGICAS</td>
                        </tr>
                        <tr>
                            <td>TC</td>
                            <td>TROCA DE AERONAVE</td>
                        </tr>
                        <tr>
                            <td>TD</td>
                            <td>DEFEITOS DA AERONAVE</td>
                        </tr>
                        <tr>
                            <td>WA</td>
                            <td>ALTERNATIVA ABAIXO DOS LIMITES</td>
                        </tr>
                        <tr>
                            <td>WI</td>
                            <td>DEGELO E REMO√á√ÉO DE NEVE E/OU LAMA EM AERONAVE</td>
                        </tr>
                        <tr>
                            <td>WR</td>
                            <td>ATRASO DEVIDO RETORNO ‚Äì CONDI√á√ïES METEOROL√ìGICAS</td>
                        </tr>
                        <tr>
                            <td>WO</td>
                            <td>AEROPORTO ORIGEM ABAIXO DOS LIMITES</td>
                        </tr>
                        <tr>
                            <td>WP</td>
                            <td>ATRASO DEVIDO RETORNO ‚Äì ORDEM T√âCNICA</td>
                        </tr>
                        <tr>
                            <td>WT</td>
                            <td>AEROPORTO DESTINO ABAIXO DOS LIMITES</td>
                        </tr>
                        <tr>
                            <td>WS</td>
                            <td>REMO√á√ÉO GELO/√ÅGUA/LAMA/AREIA EM AEROPORTO</td>
                        </tr>

                        <tr>
                            <td>XA</td>
                            <td>PROGRAMADO ‚Äì FERIADO NACIONAL</td>
                        </tr>
                        <tr>
                            <td>XB</td>
                            <td>AUTORIZADO (CANCELAMENTO)</td>
                        </tr>
                        <tr>
                            <td>XI</td>
                            <td>CANCELAMENTO ‚Äì AEROPORTO DE ORIGEM INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>XJ</td>
                            <td>CANCELAMENTO ‚Äì AEROPORTO DE DESTINO INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>XL</td>
                            <td>FALTA PAX COM PASSAGEM MARCADA ‚Äì (LINHAS DOM√âSTICAS REGIONAIS)</td>
                        </tr>
                        <tr>
                            <td>XM</td>
                            <td>CANCELAMENTO ‚Äì CONEX√ÉO/VOLTA ‚Äì V√îO DE IDA CANCELADO ‚Äì AEROPORTO INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>XN</td>
                            <td>CANCELAMENTO POR MOTIVOS T√âCNICOS/OPERACIONAIS</td>
                        </tr>
                        <tr>
                            <td>XO</td>
                            <td>CANCELAMENTO ‚Äì AEROPORTO ORIGEM ABAIXO LIMITES</td>
                        </tr>
                        <tr>
                            <td>XT</td>
                            <td>CANCELAMENTO ‚Äì AEROPORTO DESTINO ABAIXO LIMITES</td>
                        </tr>
                        <tr>
                            <td>XR</td>
                            <td>CANCELAMENTO DE V√îOS EM CODE SHARING</td>
                        </tr>
                        <tr>
                            <td>XS</td>
                            <td>CANCELAMENTO ‚Äì CONEX√ÉO/VOLTA ‚Äì CONDI√á√ïES METEOROL√ìGICAS</td>
                        </tr>

                        <tr>
                            <td>ST</td>
                            <td>INCLUS√ÉO DE ETAPA DEVIDO CANCELAMENTO DE ESCALAS</td>
                        </tr>
                        <tr>
                            <td>IR</td>
                            <td>INCLUS√ÉO DE ETAPA (AEROPORTO ALTERNATIVA) ‚Äì V√îO ESPECIAL RETORNO</td>
                        </tr>
                        <tr>
                            <td>VR</td>
                            <td>V√îO ESPECIAL DE RETORNO</td>
                        </tr>
                        <tr>
                            <td>VE</td>
                            <td>V√îO ESPECIAL DE EXPERI√äNCIA</td>
                        </tr>
                        <tr>
                            <td>VI</td>
                            <td>V√îO ESPECIAL DE INSTRU√á√ÉO</td>
                        </tr>

                        <tr>
                            <td>HA</td>
                            <td>AUTORIZADA (ALTERA√á√ÉO DE HOR√ÅRIO)</td>
                        </tr>
                        <tr>
                            <td>HB</td>
                            <td>V√îO > 4H ATRASO ‚Äì PANE AERONAVE</td>
                        </tr>
                        <tr>
                            <td>HC</td>
                            <td>V√îO > 4H ATRASO ‚Äì AEROPORTO INTERDITADO</td>
                        </tr>
                        <tr>
                            <td>HD</td>
                            <td>ANTECIPA√á√ÉO DE HOR√ÅRIO AUTORIZADA</td>
                        </tr>
                        <tr>
                            <td>HI</td>
                            <td>ANTECIPA√á√ÉO DE HOR√ÅRIO ‚Äì V√îOS INTERNACIONAIS</td>
                        </tr>
                    </tbody>
                </table>

            </div>

        </div>
    </div>





    <!-- IMPORTAR Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- IMPORTAR plugin de DataLabels -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script>

        const nomeUsuario = new URLSearchParams(window.location.search("nome"));

        getElementById('nome').innerHTML = nomeUsuario;

        console.log(nome);

        // Pegando os ids
        const fkEmpresa = localStorage.getItem('fkEmpresa');



        //Kpis

        //KPI 1
        fetch(`/voos/kpi1/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    exibirKpi1(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Kpi 1: ${error.message}`);
            });



        function exibirKpi1(kpi1) {
            const kpi1_id = document.getElementById('kpi1');
            kpi1_id.innerHTML = `${kpi1[0].total_voos} voos`;


        }

        // KPI 2
        fetch(`/voos/kpi2/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    exibirKpi2(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Kpi 1: ${error.message}`);
            });



        function exibirKpi2(kpi2) {
            const kpi2_id = document.getElementById('kpi2');
            kpi2_id.innerHTML = `${kpi2[0].voos_sem_atraso} voos | <span
        style="color: #3A6EA5; font-weight: bolder;">${kpi2[0].porcentagem}</span>`;

            sessionStorage.PORCENTAGEM_KPI2 = kpi2[0].porcentagem;
        }

        // KPI 3
        fetch(`/voos/kpi3/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    exibirKpi3(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Kpi 3: ${error.message}`);
            });



        function exibirKpi3(kpi3) {
            const kpi3_id = document.getElementById('kpi3');
            kpi3_id.innerHTML = `${kpi3[0].voos_com_atraso} voos | <span
        style="color: #3A6EA5; font-weight: bolder;">${kpi3[0].porcentagem}</span>`;
            sessionStorage.PORCENTAGEM_KPI3 = kpi3[0].porcentagem;
        }


        // KPI 4
        fetch(`/voos/kpi4/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    exibirKpi4(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Kpi 4: ${error.message}`);
            });



        function exibirKpi4(kpi4) {
            const kpi4_id = document.getElementById('kpi4');
            kpi4_id.innerHTML = `${kpi4[0].voos_cancelados} voos | <span
        style="color: #3A6EA5; font-weight: bolder;">${kpi4[0].porcentagem}</span>`;

            sessionStorage.PORCENTAGEM_KPI4 = kpi4[0].porcentagem;
        }

        // ----------------- grafico DE TORTA -------------- //

        // porcentagem grafico de torta
        const porcentagens = [];

        porcentagens.push(parseFloat(sessionStorage.PORCENTAGEM_KPI2.replace('%', '')));
        porcentagens.push(parseFloat(sessionStorage.PORCENTAGEM_KPI3.replace('%', '')));
        porcentagens.push(parseFloat(sessionStorage.PORCENTAGEM_KPI4.replace('%', '')));


        const DATA_COUNT = 5;
        const NUMBER_CFG = { count: DATA_COUNT, min: 0, max: 100 };

        const data = {
            labels: ['sem atrasos', 'com atrasos', 'cancelados'],
            datasets: [
                {
                    label: 'Voos',
                    data: porcentagens,
                    backgroundColor: ['#003459', '#90E0EF', '#00A8E8'],
                }
            ]
        };

        const config = {
            type: 'pie',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    datalabels: {
                        color: 'white',
                        formatter: (value, ctx) => {
                            const values = ctx.chart.data.datasets[0].data;
                            const total = values.reduce((a, b) => a + b, 0);
                            const percent = ((value / total) * 100).toFixed(1) + '%';
                            return percent;
                        },
                        font: {
                            weight: 'bold',
                            size: 14
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        };

        const ctx = document.getElementById('meuGraficoPie');
        new Chart(ctx, config);


        // ----------------- grafico barra 1 -------------- //
        const codigo_justificativa = [];
        const qtd_vezes = [];

        fetch(`/voos/graficoJustificativas/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta.forEach(codigo => {
                        codigo_justificativa.push(codigo.codigo_justificativa);
                    });

                    resposta.forEach(qtd => {
                        qtd_vezes.push(qtd.qtd_vezes);
                    });

                    exibirJustificativas(codigo_justificativa, qtd_vezes);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Gr√°fico de top 10 justificativas: ${error.message}`);
            });



        function exibirJustificativas(codigo_justificativa, qtd_vezes) {



            const DATA_COUNTbar1 = 10;
            const NUMBER_CFGbar1 = { count: DATA_COUNTbar1, min: 0, max: 100 };

            const dataBar1 = {
                labels: codigo_justificativa,
                datasets: [
                    {
                        data: qtd_vezes,
                        backgroundColor: [
                            '#3A6EA5', '#3A6EA5', '#3A6EA5',
                            '#3A6EA5', '#3A6EA5', '#3A6EA5',
                            '#3A6EA5', '#3A6EA5', '#3A6EA5', '#3A6EA5'
                        ]
                    }
                ]
            };

            const configBar1 = {
                type: 'bar',
                data: dataBar1,
                options: {
                    responsive: true,
                    plugins: {
                        legend: false,
                        title: {
                            display: true,
                            text: 'Top 10 c√≥digos de justificativas mais indicados'
                        },
                        datalabels: {
                            anchor: 'centre',
                            align: 'centre',
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 12
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            };

            const ctxBar1 = document.getElementById('meuGraficoBarra1');
            new Chart(ctxBar1, configBar1);

        }





        // ---------------- grafico barra 2 --------------- //

        const rotas = [];
        const quantidade_atrasos = [];
        const media_atrasos = [];

        fetch(`/voos/graficoDesempenho/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta.forEach(rotaAtual => {
                        rotas.push(rotaAtual.rota);
                    });

                    resposta.forEach(qtd => {
                        quantidade_atrasos.push(qtd.quantidade_atrasos);
                    });

                    resposta.forEach(media_atraso => {
                        media_atrasos.push(parseFloat(media_atraso.media_atraso));
                    });

                    exibirDesempenho(rotas, quantidade_atrasos, media_atrasos);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Gr√°fico de top 10 justificativas: ${error.message}`);
            });

        function exibirDesempenho(rotas, quantidade_atrasos, media_atrasos) {

            const labels = rotas;

            const data1 = quantidade_atrasos; // Barras
            const data2 = media_atrasos; // Linha

            // üî• Novo dataset corrigido
            const dataBar2 = {
                labels: labels,
                datasets: [
                    {
                        label: 'Quantidade de atrasos por rota',
                        data: data1,
                        backgroundColor: [
                            '#FF6700'
                        ],
                        stack: 'combined',
                        type: 'bar',
                        order: 0,


                        // üî• DataLabels para as barras
                        datalabels: {
                            anchor: 'center',
                            align: 'center',
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 12
                            },

                        }
                    },
                    {
                        label: 'M√©dia de tempo de atraso',
                        data: data2,
                        borderColor: '#36a2eb',
                        backgroundColor: '#36a2eb',
                        type: 'bar',
                        fill: false,
                        order: 1,


                        // üî• DataLabels para a linha
                        datalabels: {
                            anchor: 'center',
                            align: 'center',
                            color: 'black',
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                        }
                    }
                ]
            };

            const configBar2 = {
                type: 'bar',
                data: dataBar2,
                options: {
                    responsive: true,

                    plugins: {
                        title: {
                            display: true,
                            text: 'Desempenho de Atrasos por Rota (Contagem e M√©dia)'
                        },

                        // üî• Ativando DataLabels globalmente
                        datalabels: {
                            display: true
                        }
                    },

                    scales: {
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                },
                plugins: [ChartDataLabels]
            };

            // Inicializa o Gr√°fico
            const ctxBar2 = document.getElementById('meuGraficoBarra2').getContext('2d');
            new Chart(ctxBar2, configBar2);
        }

        // ---------------- tabela voos --------------- //

        fetch(`/voos/tabelaVoos/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.status === 204) {
                alert('Nenhuma dado encontrada.');
                return;
            }
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    exibirVoos(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obten√ß√£o dos dados p/ Gr√°fico de top 10 justificativas: ${error.message}`);
            });

        function exibirVoos(resposta) {
            const tbody_voos = document.getElementById("tbody_voos");
            let voos = "";

            resposta.forEach(resposta => {
                voos += `<tr>
                            <td>${resposta.numero_voo}</td>
                            <td>${resposta.data_prevista}</td>
                            <td>${resposta.previsao_partida}</td>
                            <td>${resposta.previsao_chegada}</td>
                            <td>${resposta.partida}</td>
                            <td>${resposta.chegada}</td>
                            <td>${resposta.atraso_chegada}</td>
                            <td>${resposta.atraso_partida}</td>
                            <td>${resposta.atraso_total}</td>
                            <td>${resposta.origem}</td>
                            <td>${resposta.destino}</td>
                            <td>${resposta.codigo_justificativa}</td>
                        </tr>\n`
            })

            tbody_voos.innerHTML = voos;

        }





        const modal2 = document.getElementById("modal2");
        const modal3 = document.getElementById("modal3");

        const btnVoos = document.getElementById("tabelaDadosVoos");
        const btnLegenda = document.getElementById("tabelaLegendaJustificativas");

        const fechar2 = document.getElementById("modal2-fechar");
        const fechar3 = document.getElementById("modal3-fechar");

        // Abrir modal de voos
        btnVoos.onclick = () => {
            modal2.style.display = "block";
        };

        // Abrir modal de legendas
        btnLegenda.onclick = () => {
            modal3.style.display = "block";
        };

        // Fechar modais
        fechar2.onclick = () => modal2.style.display = "none";
        fechar3.onclick = () => modal3.style.display = "none";

        // Fechar ao clicar fora
        window.onclick = (e) => {
            if (e.target === modal2) modal2.style.display = "none";
            if (e.target === modal3) modal3.style.display = "none";
        };


    </script>
</body>

</html>